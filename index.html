
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Configure Python apps easily" name="description"/>
<link href="https://triaxtec.github.io/flex-config/" rel="canonical"/>
<link href="assets/images/favicon.png" rel="shortcut icon"/>
<meta content="mkdocs-1.1, mkdocs-material-5.1.5" name="generator"/>
<title>flex-config</title>
<link href="assets/stylesheets/main.df84b5fe.min.css" rel="stylesheet"/>
<link href="assets/stylesheets/palette.8435c73a.min.css" rel="stylesheet"/>
<meta content="#2196f3" name="theme-color"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
</head>
<body data-md-color-accent="green" data-md-color-primary="blue" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#flex-config">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header-nav md-grid">
<a aria-label="flex-config" class="md-header-nav__button md-logo" href="https://triaxtec.github.io/flex-config" title="flex-config">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
<label class="md-header-nav__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header-nav__title" data-md-component="header-title">
<div class="md-header-nav__ellipsis">
<span class="md-header-nav__topic md-ellipsis">
            flex-config
          </span>
<span class="md-header-nav__topic md-ellipsis">
            
              Tutorial
            
          </span>
</div>
</div>
<label class="md-header-nav__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" data-md-component="search-reset" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header-nav__source">
<a class="md-source" href="https://github.com/triaxtec/flex-config" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 480 512" xmlns="http://www.w3.org/2000/svg"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg>
</div>
<div class="md-source__repository">
    triaxtec/flex-config
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="flex-config" class="md-nav__button md-logo" href="https://triaxtec.github.io/flex-config" title="flex-config">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
    flex-config
  </label>
<div class="md-nav__source">
<a class="md-source" href="https://github.com/triaxtec/flex-config" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 480 512" xmlns="http://www.w3.org/2000/svg"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg>
</div>
<div class="md-source__repository">
    triaxtec/flex-config
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
        Tutorial
        <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"></path></svg>
</span>
</label>
<a class="md-nav__link md-nav__link--active" href="." title="Tutorial">
      Tutorial
    </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#installation">
    Installation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#walkthrough">
    Walkthrough
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="CHANGELOG/" title="Changelog">
      Changelog
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" id="nav-3" type="checkbox"/>
<label class="md-nav__link" for="nav-3">
      API
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg>
</span>
</label>
<nav aria-label="API" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-3">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
        API
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="api/flex_config/" title="FlexConfig">
      FlexConfig
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="api/config_source/" title="ConfigSource">
      ConfigSource
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="api/env_source/" title="EnvSource">
      EnvSource
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="api/yaml_source/" title="YAMLSource">
      YAMLSource
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="api/aws_source/" title="AWSSource">
      AWSSource
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#installation">
    Installation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#walkthrough">
    Walkthrough
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<h1 id="flex-config">Flex Config<a class="headerlink" href="#flex-config" title="Permanent link">¶</a></h1>
<p><a href="https://codecov.io/gh/triaxtec/flex-config"><img alt="codecov" src="https://codecov.io/gh/triaxtec/flex-config/branch/master/graph/badge.svg?token=3utvPfZSLB"/></a></p>
<p>If you are not reading this from the <a href="https://triaxtec.github.io/flex-config">hosted documentation</a> I recommend you switch over to that for the best viewing
 experience.</p>
<p>FlexConfig is designed specifically to make configuring web apps as easy as possible on AWS. A similar pattern is followed 
whether deploying to EC2, ECS, or Lambda. Ultimately, FlexConfig is a glorified dict that makes loading from multiple 
sources easy, and provides some simple path-like lookup features.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flex_config</span> <span class="kn">import</span> <span class="n">FlexConfig</span>

<span class="n">flex_config</span> <span class="o">=</span> <span class="n">FlexConfig</span><span class="p">()</span>
<span class="c1"># In FlexConfig, these two are equivalent</span>
<span class="n">flex_config</span><span class="p">[</span><span class="s2">"app"</span><span class="p">][</span><span class="s2">"env"</span><span class="p">]</span> <span class="o">==</span> <span class="n">flex_config</span><span class="p">[</span><span class="s2">"app/env"</span><span class="p">]</span>
</code></pre></div>
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">¶</a></h2>
<p>Basic install: <code>poetry install flex_config</code>
With all optional dependencies: <code>poetry install flex_config -E all</code></p>
<h2 id="walkthrough">Walkthrough<a class="headerlink" href="#walkthrough" title="Permanent link">¶</a></h2>
<p>We'll use a simplified version of the <code>config.py</code> included in our 
<a href="https://triaxtec.github.io/fastapi-serverless-cookiecutter/">fastapi-serverless-cookiecutter</a> for illustration.</p>
<p>Everything is based around the <a href="api/flex_config/">FlexConfig</a> class, that is what will store all of your config. Generally you want to
 create <em>one</em> of these and load its details only at startup, then reuse the same instance throughout the application.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In the below example we use all of the sources that come with flex_config. If you want to use all of them, you have 
to install optional dependencies. The easiest way is to <code>poetry install flex_config -E all</code>. If you only need specific 
sources (not all), then look at the API docs for that particular source to see what if any optional dependency you need.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>

<span class="hll"><span class="kn">from</span> <span class="nn">flex_config</span> <span class="kn">import</span> <span class="n">AWSSource</span><span class="p">,</span> <span class="n">EnvSource</span><span class="p">,</span> <span class="n">FlexConfig</span><span class="p">,</span> <span class="n">YAMLSource</span>
</span>
<span class="hll"><span class="n">_app_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FlexConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span class="n">yaml_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span> <span class="o">/</span> <span class="s2">"config.yml"</span>


<span class="n">default_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"env"</span><span class="p">:</span> <span class="s2">"local"</span><span class="p">,</span>
<span class="p">}</span>


<span class="hll"><span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="n">override</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FlexConfig</span><span class="p">:</span>
</span>    <span class="sd">""" Get the app config for this  """</span>
<span class="hll">    <span class="k">global</span> <span class="n">_app_config</span>
</span>
<span class="hll">    <span class="k">if</span> <span class="n">_app_config</span><span class="p">:</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">_app_config</span>
</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">override</span><span class="p">:</span>
        <span class="n">override</span> <span class="o">=</span> <span class="p">{}</span>

<span class="hll">    <span class="n">_app_config</span> <span class="o">=</span> <span class="n">FlexConfig</span><span class="p">()</span>
</span>    <span class="n">_app_config</span><span class="o">.</span><span class="n">load_sources</span><span class="p">([</span>
        <span class="n">default_config</span><span class="p">,</span>
        <span class="n">EnvSource</span><span class="p">(</span><span class="s2">"APP_"</span><span class="p">),</span>
        <span class="n">YAMLSource</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">),</span>
        <span class="n">override</span><span class="p">,</span>
    <span class="p">])</span>

    <span class="n">env</span> <span class="o">=</span> <span class="n">_app_config</span><span class="p">[</span><span class="s2">"env"</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">env</span> <span class="o">!=</span> <span class="s2">"local"</span><span class="p">:</span>
        <span class="n">_app_config</span><span class="o">.</span><span class="n">load_sources</span><span class="p">(</span><span class="n">AWSSource</span><span class="p">(</span><span class="sa">f</span><span class="s2">"app/</span><span class="si">{</span><span class="n">env</span><span class="si">}</span><span class="s2">"</span><span class="p">))</span>

<span class="hll">    <span class="k">return</span> <span class="n">_app_config</span>
</span></code></pre></div>
<p>In the highlighted code, we:</p>
<ol>
<li><code>import FlexConfig</code></li>
<li>Declare a private global instance called <code>_app_config</code>, defaulting to <code>None</code>.</li>
<li>Declare a function called <code>get_config</code>. This is how every other part of the app will get the config.</li>
<li>Use the global <code>_app_config</code> locally in our function.</li>
<li>Return the global <code>_app_config</code> if it's already been set. This prevents us re-loading the config.</li>
<li>If <code>_app_config</code> hasn't been set up yet, we set it to a brand new <a href="api/flex_config/">FlexConfig</a>.</li>
<li>Return our loaded up config object.</li>
</ol>
<p>Now let's take a look at <em>where</em> we are loading the config from that ends up in <code>_app_config</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">flex_config</span> <span class="kn">import</span> <span class="n">AWSSource</span><span class="p">,</span> <span class="n">EnvSource</span><span class="p">,</span> <span class="n">FlexConfig</span><span class="p">,</span> <span class="n">YAMLSource</span>

<span class="n">_app_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FlexConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">yaml_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span> <span class="o">/</span> <span class="s2">"config.yml"</span>


<span class="hll"><span class="n">default_config</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="hll">    <span class="s2">"env"</span><span class="p">:</span> <span class="s2">"local"</span><span class="p">,</span>
</span><span class="hll"><span class="p">}</span>
</span>

<span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="n">override</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FlexConfig</span><span class="p">:</span>
    <span class="sd">""" Get the app config for this  """</span>
    <span class="k">global</span> <span class="n">_app_config</span>

    <span class="k">if</span> <span class="n">_app_config</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_app_config</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">override</span><span class="p">:</span>
        <span class="n">override</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">_app_config</span> <span class="o">=</span> <span class="n">FlexConfig</span><span class="p">()</span>
<span class="hll">    <span class="n">_app_config</span><span class="o">.</span><span class="n">load_sources</span><span class="p">([</span>
</span><span class="hll">        <span class="n">default_config</span><span class="p">,</span>
</span>        <span class="n">EnvSource</span><span class="p">(</span><span class="s2">"APP_"</span><span class="p">),</span>
        <span class="n">YAMLSource</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">),</span>
        <span class="n">override</span><span class="p">,</span>
<span class="hll">    <span class="p">])</span>
</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">_app_config</span><span class="p">[</span><span class="s2">"env"</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">env</span> <span class="o">!=</span> <span class="s2">"local"</span><span class="p">:</span>
        <span class="n">_app_config</span><span class="o">.</span><span class="n">load_sources</span><span class="p">(</span><span class="n">AWSSource</span><span class="p">(</span><span class="sa">f</span><span class="s2">"app/</span><span class="si">{</span><span class="n">env</span><span class="si">}</span><span class="s2">"</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">_app_config</span>
</code></pre></div>
<p>We have some defaults set in the code itself. Here this is a simple <code>dict</code> which very intentionally conforms to the 
 <a href="api/config_source/">ConfigSource</a> Protocol which is required for anything passed into <a href="api/flex_config/#flex_config.FlexConfig.load_sources">load_sources</a>. If you have a lot of defaults, you
 may want to use a <a href="api/yaml_source/">YAMLSource</a> instead.</p>
<p>Sources passed into <a href="api/flex_config/#flex_config.FlexConfig.load_sources">load_sources</a> are loaded <strong>in order</strong>. So in our case, we pass in <code>default_config</code> first so that
 every source we load later overrides it.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>

<span class="hll"><span class="kn">from</span> <span class="nn">flex_config</span> <span class="kn">import</span> <span class="n">AWSSource</span><span class="p">,</span> <span class="n">EnvSource</span><span class="p">,</span> <span class="n">FlexConfig</span><span class="p">,</span> <span class="n">YAMLSource</span>
</span>
<span class="n">_app_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FlexConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">yaml_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span> <span class="o">/</span> <span class="s2">"config.yml"</span>


<span class="n">default_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"env"</span><span class="p">:</span> <span class="s2">"local"</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="n">override</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FlexConfig</span><span class="p">:</span>
    <span class="sd">""" Get the app config for this  """</span>
    <span class="k">global</span> <span class="n">_app_config</span>

    <span class="k">if</span> <span class="n">_app_config</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_app_config</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">override</span><span class="p">:</span>
        <span class="n">override</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">_app_config</span> <span class="o">=</span> <span class="n">FlexConfig</span><span class="p">()</span>
<span class="hll">    <span class="n">_app_config</span><span class="o">.</span><span class="n">load_sources</span><span class="p">([</span>
</span>        <span class="n">default_config</span><span class="p">,</span>
<span class="hll">        <span class="n">EnvSource</span><span class="p">(</span><span class="s2">"APP_"</span><span class="p">),</span>
</span>        <span class="n">YAMLSource</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">),</span>
        <span class="n">override</span><span class="p">,</span>
<span class="hll">    <span class="p">])</span>
</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">_app_config</span><span class="p">[</span><span class="s2">"env"</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">env</span> <span class="o">!=</span> <span class="s2">"local"</span><span class="p">:</span>
        <span class="n">_app_config</span><span class="o">.</span><span class="n">load_sources</span><span class="p">(</span><span class="n">AWSSource</span><span class="p">(</span><span class="sa">f</span><span class="s2">"app/</span><span class="si">{</span><span class="n">env</span><span class="si">}</span><span class="s2">"</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">_app_config</span>
</code></pre></div>
<p>Next, we're including an <a href="api/env_source/">EnvSource</a> to load values from environment variables. Usually, this source is used to load
 just enough info to be able to load from other sources. In the case of our serverless applications (where this was 
 taken from), we load the "env" config value to tell us which environment this is running in (e.g. "dev"). You could
 load your entire application's config from <a href="api/env_source/">EnvSource</a> if you wanted to, say, load a bunch of stuff from AWS Secrets
 manager into environment variables at boot up.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>

<span class="hll"><span class="kn">from</span> <span class="nn">flex_config</span> <span class="kn">import</span> <span class="n">AWSSource</span><span class="p">,</span> <span class="n">EnvSource</span><span class="p">,</span> <span class="n">FlexConfig</span><span class="p">,</span> <span class="n">YAMLSource</span>
</span>
<span class="n">_app_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FlexConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">yaml_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span> <span class="o">/</span> <span class="s2">"config.yml"</span>


<span class="n">default_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"env"</span><span class="p">:</span> <span class="s2">"local"</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="n">override</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FlexConfig</span><span class="p">:</span>
    <span class="sd">""" Get the app config for this  """</span>
    <span class="k">global</span> <span class="n">_app_config</span>

    <span class="k">if</span> <span class="n">_app_config</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_app_config</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">override</span><span class="p">:</span>
        <span class="n">override</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">_app_config</span> <span class="o">=</span> <span class="n">FlexConfig</span><span class="p">()</span>
<span class="hll">    <span class="n">_app_config</span><span class="o">.</span><span class="n">load_sources</span><span class="p">([</span>
</span>        <span class="n">default_config</span><span class="p">,</span>
        <span class="n">EnvSource</span><span class="p">(</span><span class="s2">"APP_"</span><span class="p">),</span>
<span class="hll">        <span class="n">YAMLSource</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">),</span>
</span>        <span class="n">override</span><span class="p">,</span>
<span class="hll">    <span class="p">])</span>
</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">_app_config</span><span class="p">[</span><span class="s2">"env"</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">env</span> <span class="o">!=</span> <span class="s2">"local"</span><span class="p">:</span>
        <span class="n">_app_config</span><span class="o">.</span><span class="n">load_sources</span><span class="p">(</span><span class="n">AWSSource</span><span class="p">(</span><span class="sa">f</span><span class="s2">"app/</span><span class="si">{</span><span class="n">env</span><span class="si">}</span><span class="s2">"</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">_app_config</span>
</code></pre></div>
<p>Next up is a <a href="api/yaml_source/">YAMLSource</a>. Commonly we use this to store local config when developing since setting up environment
 variables or SSM config is cumbersome for values that may change frequently.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">flex_config</span> <span class="kn">import</span> <span class="n">AWSSource</span><span class="p">,</span> <span class="n">EnvSource</span><span class="p">,</span> <span class="n">FlexConfig</span><span class="p">,</span> <span class="n">YAMLSource</span>

<span class="n">_app_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FlexConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">yaml_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span> <span class="o">/</span> <span class="s2">"config.yml"</span>


<span class="n">default_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"env"</span><span class="p">:</span> <span class="s2">"local"</span><span class="p">,</span>
<span class="p">}</span>


<span class="hll"><span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="n">override</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FlexConfig</span><span class="p">:</span>
</span>    <span class="sd">""" Get the app config for this  """</span>
    <span class="k">global</span> <span class="n">_app_config</span>

    <span class="k">if</span> <span class="n">_app_config</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_app_config</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">override</span><span class="p">:</span>
        <span class="n">override</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">_app_config</span> <span class="o">=</span> <span class="n">FlexConfig</span><span class="p">()</span>
<span class="hll">    <span class="n">_app_config</span><span class="o">.</span><span class="n">load_sources</span><span class="p">([</span>
</span>        <span class="n">default_config</span><span class="p">,</span>
        <span class="n">EnvSource</span><span class="p">(</span><span class="s2">"APP_"</span><span class="p">),</span>
        <span class="n">YAMLSource</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">),</span>
<span class="hll">        <span class="n">override</span><span class="p">,</span>
</span><span class="hll">    <span class="p">])</span>
</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">_app_config</span><span class="p">[</span><span class="s2">"env"</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">env</span> <span class="o">!=</span> <span class="s2">"local"</span><span class="p">:</span>
        <span class="n">_app_config</span><span class="o">.</span><span class="n">load_sources</span><span class="p">(</span><span class="n">AWSSource</span><span class="p">(</span><span class="sa">f</span><span class="s2">"app/</span><span class="si">{</span><span class="n">env</span><span class="si">}</span><span class="s2">"</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">_app_config</span>
</code></pre></div>
<p>In this case, we're also allowing users to provide an "override" param which we will load last. This pattern makes
 testing and loading config for CLIs much easier.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>

<span class="hll"><span class="kn">from</span> <span class="nn">flex_config</span> <span class="kn">import</span> <span class="n">AWSSource</span><span class="p">,</span> <span class="n">EnvSource</span><span class="p">,</span> <span class="n">FlexConfig</span><span class="p">,</span> <span class="n">YAMLSource</span>
</span>
<span class="n">_app_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FlexConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">yaml_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span> <span class="o">/</span> <span class="s2">"config.yml"</span>


<span class="n">default_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"env"</span><span class="p">:</span> <span class="s2">"local"</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="n">override</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FlexConfig</span><span class="p">:</span>
    <span class="sd">""" Get the app config for this  """</span>
    <span class="k">global</span> <span class="n">_app_config</span>

    <span class="k">if</span> <span class="n">_app_config</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_app_config</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">override</span><span class="p">:</span>
        <span class="n">override</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">_app_config</span> <span class="o">=</span> <span class="n">FlexConfig</span><span class="p">()</span>
    <span class="n">_app_config</span><span class="o">.</span><span class="n">load_sources</span><span class="p">([</span>
        <span class="n">default_config</span><span class="p">,</span>
        <span class="n">EnvSource</span><span class="p">(</span><span class="s2">"APP_"</span><span class="p">),</span>
        <span class="n">YAMLSource</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">),</span>
        <span class="n">override</span><span class="p">,</span>
    <span class="p">])</span>

<span class="hll">    <span class="n">env</span> <span class="o">=</span> <span class="n">_app_config</span><span class="p">[</span><span class="s2">"env"</span><span class="p">]</span>
</span><span class="hll">    <span class="k">if</span> <span class="n">env</span> <span class="o">!=</span> <span class="s2">"local"</span><span class="p">:</span>
</span><span class="hll">        <span class="n">_app_config</span><span class="o">.</span><span class="n">load_sources</span><span class="p">(</span><span class="n">AWSSource</span><span class="p">(</span><span class="sa">f</span><span class="s2">"app/</span><span class="si">{</span><span class="n">env</span><span class="si">}</span><span class="s2">"</span><span class="p">))</span>
</span>
    <span class="k">return</span> <span class="n">_app_config</span>
</code></pre></div>
<p>Finally, we're going to check which environment we're running in (loaded by all the previous sources). If we're not
 running locally, we load the rest of our config from AWS SSM. In this case, we've stored that info under the prefix 
 "app/env" (e.g. "app/dev") though there is no limit to the length of the prefix nor the number of AWS sources you 
 can load from.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav aria-label="Footer" class="md-footer-nav__inner md-grid">
<a class="md-footer-nav__link md-footer-nav__link--next" href="CHANGELOG/" rel="next" title="Changelog">
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Next
                </span>
                Changelog
              </div>
</div>
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
</div>
</div>
</footer>
</div>
<script src="assets/javascripts/vendor.83fe6e3c.min.js"></script>
<script src="assets/javascripts/bundle.7e1cb91c.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
<script>
        app = initialize({
          base: ".",
          features: [],
          search: Object.assign({
            worker: "assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
</body>
</html>